{"version":3,"sources":["../../../../src/db/graphql/resolvers/confirmAddTeamMember.js"],"names":["executeConfirmAddTeamMember","nonce","userteam","UserTeam","findOne","where","activationNonce","err","response","session","Session","userId","set","team","getTeam","active","save","name","console","error","message","confirmAddTeamMember","_","args","context","log"],"mappings":";;;;;;;;;;AAAA;;;;AACA;;;;;;AAEA,MAAMA;AAAA,6CAA8B,WAAO,EAAEC,KAAF,EAAP,EAAqB;AACvD,QAAI;AACF,YAAMC,WAAW,MAAM,wBAAGC,QAAH,CAAYC,OAAZ,CAAoB,EAAEC,OAAO,EAAEC,iBAAiBL,KAAnB,EAAT,EAApB,CAAvB;AACA,UAAG,CAACC,QAAJ,EAAc;AAAE,eAAO,EAAEK,KAAK,IAAP,EAAaC,UAAU,+BAAvB,EAAP;AAAiE;AACjF,YAAMC,UAAW,MAAM,wBAAGC,OAAH,CAAWN,OAAX,CAAmB,EAAEC,OAAO,EAAEM,QAAQT,SAASS,MAAnB,EAAT,EAAnB,CAAvB;AACA,UAAG,CAACF,OAAJ,EAAa;AAAE,eAAO,EAAEF,KAAK,IAAP,EAAaC,UAAU,+BAAvB,EAAP;AAAiE;AAChFN,eAASU,GAAT,CAAa,QAAb,EAAuB,IAAvB;AACA,YAAMC,OAAO,MAAMX,SAASY,OAAT,EAAnB;AACA,UAAG,CAACD,KAAKE,MAAT,EAAiB;AAAE,eAAO,EAAER,KAAK,IAAP,EAAaC,UAAU,mHAAvB,EAAP;AAAqJ;AACxK,YAAMN,SAASc,IAAT,EAAN;AACA,aAAO,EAAET,KAAK,KAAP,EAAcC,UAAW,uBAAsBK,KAAKI,IAAK,EAAzD,EAAP;AACD,KAVD,CAUE,OAAMV,GAAN,EAAW;AACXW,cAAQC,KAAR,CAAcZ,GAAd;AACA,aAAO,EAAEA,KAAK,IAAP,EAAaC,UAAUD,IAAIa,OAA3B,EAAP;AACD;AACF,GAfK;;AAAA;AAAA;AAAA;AAAA,IAAN;;AAiBA,MAAMC,uBAAuB,CAACC,CAAD,EAAIC,IAAJ,EAAUC,OAAV,KAAsB;AACjDN,UAAQO,GAAR,CAAY,eAAZ;AACA,SAAOzB,4BAA4BuB,IAA5B,CAAP;AACD,CAHD;;kBAKeF,oB","file":"confirmAddTeamMember.js","sourcesContent":["import db from '../../sequelize/models/db_connection'\nimport mailClient from '../../../lib/mail_client'\n\nconst executeConfirmAddTeamMember = async ({ nonce }) => {\n  try {\n    const userteam = await db.UserTeam.findOne({ where: { activationNonce: nonce } })\n    if(!userteam) { return { err: true, response: 'Whoops! Something went wrong.' } }\n    const session =  await db.Session.findOne({ where: { userId: userteam.userId } })\n    if(!session) { return { err: true, response: 'Whoops! Something went wrong.' } }\n    userteam.set('active', true)\n    const team = await userteam.getTeam()\n    if(!team.active) { return { err: true, response: 'I\\'m sorry that team is no longer active. Please contact the person who invited you to join for more information.' } }\n    await userteam.save()\n    return { err: false, response: `Successfully joined ${team.name}` }\n  } catch(err) {\n    console.error(err)\n    return { err: true, response: err.message }\n  }\n}\n\nconst confirmAddTeamMember = (_, args, context) => {\n  console.log('addTeamMember')\n  return executeConfirmAddTeamMember(args)\n}\n\nexport default confirmAddTeamMember\n"]}